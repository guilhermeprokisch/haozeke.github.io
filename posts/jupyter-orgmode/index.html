<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="[Rohit Goswami]">
<meta name="description" content="Background  I dislike Jupyter notebooks (and JupyterHub) a lot EIN is really not much of a solution either  In the past I have written some posts on TeX with JupyterHub and discussed ways to use virtual Python with JupyterHub in a more reasonable manner.
However, I personally found that EIN was a huge pain to work with, and I mostly ended up working with the web-interface anyway." />
<meta name="keywords" content=", tools, emacs, workflows, python" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://rgoswami.me/posts/jupyter-orgmode/" />


    <title>
        
            Replacing Jupyter with Orgmode :: Rohit Goswami  — A micellany of my thoughts
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://rgoswami.me/main.min.7bfbbe12786fa0ded4b4c0d792cbb36a5bd0bdb0b856dde57aa7b1f6fe0f2b87.css">




<meta itemprop="name" content="Replacing Jupyter with Orgmode">
<meta itemprop="description" content="Background  I dislike Jupyter notebooks (and JupyterHub) a lot EIN is really not much of a solution either  In the past I have written some posts on TeX with JupyterHub and discussed ways to use virtual Python with JupyterHub in a more reasonable manner.
However, I personally found that EIN was a huge pain to work with, and I mostly ended up working with the web-interface anyway.">


<meta itemprop="datePublished" content="2020-02-13T22:36:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-02-13T22:36:00&#43;00:00" />
<meta itemprop="wordCount" content="847">



<meta itemprop="keywords" content="tools,emacs,workflows,python," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://rgoswami.me"/>

<meta name="twitter:title" content="Replacing Jupyter with Orgmode"/>
<meta name="twitter:description" content="Background  I dislike Jupyter notebooks (and JupyterHub) a lot EIN is really not much of a solution either  In the past I have written some posts on TeX with JupyterHub and discussed ways to use virtual Python with JupyterHub in a more reasonable manner.
However, I personally found that EIN was a huge pain to work with, and I mostly ended up working with the web-interface anyway."/>



    <meta property="article:section" content="programming" />



    <meta property="article:published_time" content="2020-02-13 22:36:00 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://rgoswami.me/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">/home/haozeke/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://rgoswami.me/about/">About</a></li><li><a href="https://rgoswami.me/posts">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>

            
<script src="https://rgoswami.me/js/mathjax-config.js"></script>


<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>4 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="https://rgoswami.me/posts/jupyter-orgmode/">Replacing Jupyter with Orgmode</a>
            </h1>

            

            <div class="post-content">
                

<h2 id="background">Background</h2>

<ul>
<li>I dislike Jupyter notebooks (and <a href="https://jupyter.org/" target="_blank">JupyterHub</a>) a lot</li>
<li><a href="https://tkf.github.io/emacs-ipython-notebook/" target="_blank">EIN</a> is really not much of a solution either</li>
</ul>

<p>In the past I have written some posts on <a href="https://grimoire.science/latex-and-jupyterhub/" target="_blank">TeX with JupyterHub</a> and discussed ways
to use virtual <a href="https://grimoire.science/python-and-jupyterhub/" target="_blank">Python with JupyterHub</a> in a more reasonable manner.</p>

<p>However, I personally found that EIN was a huge pain to work with, and I mostly
ended up working with the web-interface anyway.</p>

<p>It is a bit redundant to do so, given that at-least for my purposes, the end
result was a LaTeX document. Breaking down the rest of my requirements went a
bit like this:</p>

<dl>
<dt>What exports well to TeX?</dt>
<dd><strong>Org</strong>, Markdown, anything which goes into pandoc</dd>
<dt>What displays code really well?</dt>
<dd>LaTeX, Markdown, <strong>Org</strong></dd>
<dt>What allows easy visualization of code snippets?</dt>
<dd>Rmarkdown, RStudio,
JupyterHub, <strong>Org</strong> with babel</dd>
</dl>

<p>Clearly, <a href="https://orgmode.org/manual/" target="_blank">orgmode</a> is the common denominator, and ergo, a perfect JupyterHub alternative.</p>

<h2 id="setup">Setup</h2>

<p>Throughout this post I will assume the following structure:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tree tmp
mkdir -p tmp/images
touch tmp/myFakeJupyter.org</code></pre></div>
<table>
<thead>
<tr>
<th>tmp</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>

<tbody>
<tr>
<td>├──</td>
<td>images</td>
<td></td>
<td></td>
</tr>

<tr>
<td>└──</td>
<td>myFakeJupyter.org</td>
<td></td>
<td></td>
</tr>

<tr>
<td>1</td>
<td>directory,</td>
<td>1</td>
<td>file</td>
</tr>
</tbody>
</table>

<p>As is evident, we have a folder <code>tmp</code> which will have all the things we need for
dealing with our setup.</p>

<h3 id="virtual-python">Virtual Python</h3>

<p>Without waxing too eloquent on the whole reason behind doing this, since I will
rant about virtual python management systems elsewhere, here I will simply
describe my preferred method, which is <a href="https://python-poetry.org/" target="_blank">using poetry</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># In a folder above tmp</span>
poetry init
poetry add numpy matplotlib scipy pandas</code></pre></div>
<p>The next part is optional, but a good idea if you figure out <a href="https://direnv.net/" target="_blank">using direnv</a> and
have configured <code>layout_poetry</code> as <a href="https://rgoswami.me/posts/poetry-direnv" target="_blank">described here</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Same place as the poetry files</span>
echo <span style="color:#e6db74">&#34;layout_poetry()&#34;</span> &gt;&gt; .envrc</code></pre></div>
<p><strong>Note:</strong></p>

<ul>
<li>We can nest an arbitrary number of the <code>tmp</code> structures under a single place
we define the poetry setup</li>
<li>I prefer using <code>direnv</code> to ensure that I never forget to hook into the right environment</li>
</ul>

<h2 id="orgmode">Orgmode</h2>

<p>This is not an introduction to org, however in particular, there are some basic
settings to keep in mind to make sure the set-up works as expected.</p>

<h3 id="indentation">Indentation</h3>

<p>Python is notoriously weird about whitespace, so we will ensure that our export
process does not mangle whitespace and offend the python interpreter. We will
have the following line at the top of our <code>orgmode</code> file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-orgmode" data-lang="orgmode"><span style="color:#75715e"># -*- org-src-preserve-indentation: t; org-edit-src-content: 0; -*-</span></code></pre></div>
<p><strong>Note:</strong></p>

<ul>
<li>this post is actually generating the file being discussed here by</li>
</ul>

<p><a href="https://orgmode.org/manual/Extracting-Source-Code.html" target="_blank">tangling the file</a></p>

<ul>
<li>You can get the <a href="https://github.com/HaoZeke/haozeke.github.io/blob/src/content-org/tmp/myFakeJupyter.org" target="_blank">whole file here</a></li>
</ul>

<h3 id="tex-settings">TeX Settings</h3>

<p>These are also basically optional, but at the very least you will need the
following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-orgmode" data-lang="orgmode"><span style="color:#75715e">#+author</span><span style="color:#75715e">: Rohit Goswami</span>
<span style="color:#75715e">#+title</span><span style="color:#75715e">: Whatever</span>
<span style="color:#75715e">#+subtitle</span><span style="color:#75715e">: Wittier line about whatever</span>
<span style="color:#75715e">#+date</span><span style="color:#75715e">: \today</span>
<span style="color:#75715e">#+OPTIONS</span><span style="color:#75715e">: toc:nil</span></code></pre></div>
<p>I actually use a lot of math using the <code>TeX</code> input mode in Emacs, so I like the
following settings for math:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-orgmode" data-lang="orgmode"><span style="color:#75715e"># For math display</span>
<span style="color:#75715e">#+LATEX_HEADER</span><span style="color:#75715e">: \usepackage{amsfonts}</span>
<span style="color:#75715e">#+LATEX_HEADER</span><span style="color:#75715e">: \usepackage{unicode-math}</span></code></pre></div>
<p>There are a bunch of other settings which may be used, but these are the bare
minimum, more on that would be in a snippet anyway.</p>

<p><strong>Note:</strong></p>

<ul>
<li>rendering math in the <code>orgmode</code> file in this manner requires that we
use <code>XeTeX</code> to compile the final file</li>
</ul>

<h3 id="org-python">Org-Python</h3>

<p>We essentially need to ensure that:</p>

<ul>
<li>Babel uses our virtual python</li>
<li>The same session is used for each block</li>
</ul>

<p>We will get our poetry python pretty easily:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">which python</code></pre></div>
<p>Now we will use this as a common <code>header-arg</code> passed into the property drawer to
make sure we don&rsquo;t need to set them in every code block.</p>

<p>We can use the following structure in our file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-orgmode" data-lang="orgmode">\* Python Stuff
<span style="color:#75715e">  :PROPERTIES:
</span><span style="color:#75715e"></span><span style="color:#75715e">  :header-args:    :python /home/haozeke/.cache/pypoetry/virtualenvs/test-2aLV_5DQ-py3.8/bin/python :session One
</span><span style="color:#75715e"></span><span style="color:#75715e">  :END:</span>
Now we can simply work with code as we normally would
\#+BEGIN_SRC python
print(&#34;Hello World&#34;)
\#+END_SRC</code></pre></div>
<p><strong>Note:</strong></p>

<ul>
<li>For some reason, this property needs to be set on <strong>every</strong> heading (as of Feb 13 2020)</li>
<li>In the actual file you will want to remove extraneous  \ symbols:

<ul>
<li>\* → *</li>
<li>\#+BEGIN_SRC → #+BEGIN_SRC</li>
<li>\#+END_SRC → #+END_SRC</li>
</ul></li>
</ul>

<h3 id="python-images-and-orgmode">Python Images and Orgmode</h3>

<p>To view images in <code>orgmode</code> as we would in a JupyterLab notebook, we will use a
slight trick.</p>

<ul>
<li>We will ensure that the code block returns a file object with the arguments</li>

<li><p>The code block should end with a print statement to actually generate the file
name</p>

<p>So we want a code block like this:</p></li>
</ul>

<!--listend-->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">#+BEGIN_SRC python :results output file :exports both
import matplotlib.pyplot as plt
from sklearn.datasets.samples_generator import make_circles
X, y = make_circles(100, factor=.1, noise=.1)
plt.scatter(X[:, 0], X[:, 1], c=y, s=50, cmap=&#39;autumn&#39;)
plt.xlabel(&#39;x1&#39;)
plt.ylabel(&#39;x2&#39;)
plt.savefig(&#39;images/plotCircles.png&#39;, dpi = 300)
print(&#39;images/plotCircles.png&#39;) # return filename to org-mode
#+end_src</code></pre></div>
<p>Which would give the following when executed:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">#+RESULTS:
[[file:images/plotCircles.png]]</code></pre></div>
<p>Since that looks pretty ugly, this will actually look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">from</span> sklearn.datasets.samples_generator <span style="color:#f92672">import</span> make_circles
X, y <span style="color:#f92672">=</span> make_circles(<span style="color:#ae81ff">100</span>, factor<span style="color:#f92672">=.</span><span style="color:#ae81ff">1</span>, noise<span style="color:#f92672">=.</span><span style="color:#ae81ff">1</span>)
plt<span style="color:#f92672">.</span>scatter(X[:, <span style="color:#ae81ff">0</span>], X[:, <span style="color:#ae81ff">1</span>], c<span style="color:#f92672">=</span>y, s<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;autumn&#39;</span>)
plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;x1&#39;</span>)
plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;x2&#39;</span>)
plt<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74">&#39;images/plotCircles.png&#39;</span>, dpi <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;images/plotCircles.png&#39;</span>) <span style="color:#75715e"># return filename to org-mode</span></code></pre></div>

    <figure class="left" >
        <img src="https://rgoswami.me/ox-hugo/plotCircles.png"   />

        
    </figure>



<h3 id="conclusions">Conclusions</h3>

<ul>
<li>The last step is of course to export the file as to a <code>TeX</code> file and then
compile that with something like <code>latexmk -pdfxe -shell-escape file.tex</code></li>
</ul>

<p>There are a million and one variations of this of course, but this is enough to
get started.</p>

<p>The whole file is also <a href="https://github.com/HaoZeke/haozeke.github.io/blob/src/content-org/tmp/myFakeJupyter.org" target="_blank">reproduced here</a>.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://rgoswami.me/tags/tools">tools</a></span><span class="tag"><a href="https://rgoswami.me/tags/emacs">emacs</a></span><span class="tag"><a href="https://rgoswami.me/tags/workflows">workflows</a></span><span class="tag"><a href="https://rgoswami.me/tags/python">python</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>847 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-02-13 22:36 &#43;0000</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Read other posts</span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    

                    
                        <span class="button next">
                            <a href="https://rgoswami.me/posts/poetry-direnv/">
                                <span class="button__text">Poetry and Direnv</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="https://rgoswami.me">Rohit Goswami (HaoZeke)</a></span>
            
            <span></span>
            <span> <a href="https://rgoswami.me/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Based on a theme by <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://rgoswami.me/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js" integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-109503488-16', 'auto');
        ga('send', 'pageview');
    </script>



    </body>
</html>
